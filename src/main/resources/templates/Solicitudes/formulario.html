<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layout}">
<head>
    <meta charset="UTF-8">
    <title>Nueva Solicitud de Material</title>

    <!-- TailwindCSS -->
    <script src="https://cdn.tailwindcss.com"></script>

    <script>
        function validarFormulario(event) {
            event.preventDefault(); // Detenemos env√≠o hasta verificar

            const material = document.getElementById("material-select");
            const cantidad = document.getElementById("cantidad");
            const motivo = document.getElementById("motivo");
            const alerta = document.getElementById("alerta");
            const exito = document.getElementById("exito");
            const errores = [];

            // Reset estilos
            [material, cantidad, motivo].forEach(campo => {
                campo.classList.remove("border-red-500", "border-green-500");
            });

            // Validaciones
            if (!material.value) {
                errores.push("Debe seleccionar un material.");
                material.classList.add("border-red-500");
            } else {
                material.classList.add("border-green-500");
            }

            if (!cantidad.value || cantidad.value <= 0) {
                errores.push("Ingrese una cantidad v√°lida (mayor a 0).");
                cantidad.classList.add("border-red-500");
            } else {
                cantidad.classList.add("border-green-500");
            }

            if (motivo.value.trim().length < 5) {
                errores.push("El motivo debe tener al menos 5 caracteres.");
                motivo.classList.add("border-red-500");
            } else {
                motivo.classList.add("border-green-500");
            }

            // Mostrar errores si hay
            if (errores.length > 0) {
                alerta.innerHTML = `
                    <strong class="font-semibold">‚ö†Ô∏è Corrige los siguientes errores:</strong>
                    <ul class="list-disc ml-6 mt-2 text-sm">${errores.map(e => `<li>${e}</li>`).join("")}</ul>`;
                alerta.classList.remove("hidden");
                exito.classList.add("hidden");
                window.scrollTo({top: 0, behavior: "smooth"});
                return false;
            }

            // Si todo est√° bien, mostrar mensaje de √©xito
            alerta.classList.add("hidden");
            exito.classList.remove("hidden");

            // Peque√±a animaci√≥n y env√≠o tras 1.5 segundos
            setTimeout(() => {
                event.target.submit();
            }, 1500);
        }
    </script>
</head>
<body>
<div layout:fragment="content">
    <div class="max-w-xl mx-auto py-10">
        <div class="bg-gradient-to-br from-white to-blue-50 p-10 rounded-2xl shadow-2xl border border-gray-100">

            <h1 class="text-3xl font-extrabold text-gray-800 mb-8 text-center border-b pb-3">
                üìã Nueva Solicitud de Material
            </h1>

            <!-- Alerta de error -->
            <div id="alerta"
                 class="hidden mb-6 bg-red-50 border border-red-400 text-red-700 px-5 py-4 rounded-lg shadow-sm transition-all duration-300"></div>

            <!-- Alerta de √©xito -->
            <div id="exito"
                 class="hidden mb-6 bg-green-50 border border-green-400 text-green-700 px-5 py-4 rounded-lg shadow-sm transition-all duration-300">
                ‚úÖ <strong class="font-semibold">Solicitud v√°lida.</strong> Enviando informaci√≥n...
            </div>

            <form th:action="@{/solicitudes/guardar}" th:object="${solicitud}" method="post"
                  onsubmit="validarFormulario(event)">

                <!-- Material -->
                <div class="mb-6">
                    <label for="material-select" class="block mb-2 font-semibold text-gray-700">
                        Material a Solicitar <span class="text-red-500">*</span>
                    </label>
                    <select id="material-select" name="inventario.id" required
                            class="block w-full px-4 py-3 border border-gray-300 rounded-xl shadow-sm
                                   focus:ring-2 focus:ring-blue-400 focus:border-blue-400 bg-white transition-all duration-150">
                        <option value="" disabled selected>--- Seleccione un material ---</option>
                        <option th:each="i : ${inventarios}" th:value="${i.id}" th:text="${i.nombre}"></option>
                    </select>
                </div>

                <!-- Cantidad -->
                <div class="mb-6">
                    <label for="cantidad" class="block mb-2 font-semibold text-gray-700">
                        Cantidad Requerida <span class="text-red-500">*</span>
                    </label>
                    <input type="number" id="cantidad" th:field="*{cantidad}" min="1" required
                           placeholder="Ejemplo: 10"
                           class="block w-full px-4 py-3 border border-gray-300 rounded-xl shadow-sm
                                  focus:ring-2 focus:ring-blue-400 focus:border-blue-400 bg-white transition-all duration-150">
                </div>

                <!-- Motivo -->
                <div class="mb-8">
                    <label for="motivo" class="block mb-2 font-semibold text-gray-700">
                        Motivo de la Solicitud <span class="text-red-500">*</span>
                    </label>
                    <textarea id="motivo" th:field="*{motivo}" rows="4"
                              placeholder="Describa brevemente el prop√≥sito..."
                              class="block w-full px-4 py-3 border border-gray-300 rounded-xl shadow-sm
                                     focus:ring-2 focus:ring-blue-400 focus:border-blue-400 bg-white transition-all duration-150 resize-y"></textarea>
                </div>

                <!-- Botones -->
                <div class="flex justify-end gap-4 pt-4 border-t border-gray-200">
                    <a href="/solicitudes"
                       class="inline-flex items-center justify-center px-6 py-3 border border-gray-300 shadow-sm text-base font-medium rounded-xl text-gray-700 bg-white hover:bg-gray-100 focus:ring-2 focus:ring-offset-2 focus:ring-gray-300 transition duration-150">
                        ‚Ü©Ô∏è Cancelar
                    </a>

                    <button type="submit"
                            class="inline-flex items-center justify-center px-6 py-3 border-none shadow-md text-base font-medium rounded-xl text-white bg-blue-600 hover:bg-blue-700 focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 transition duration-150">
                        ‚úÖ Enviar Solicitud
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>
</body>
</html>
